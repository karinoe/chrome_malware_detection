'use strict';

var htmlJSResults = {};
var trhValues = {
    'wordCount_trh': 0,
    'distinctWordCount_trh': 0,
    'avgWordLength_trh': 0,
    'tagCount_trh': 0,
    'urlCount_trh': 0,
    'iframeCount_trh': 0,
    'zeroIFrameCount_trh': 0,
    'dblDoc_trh': 'yes',
    'eval_trh': 0,
    'escape_trh': 0,
    'link_trh': 0,
    'exec_trh': 0,
    'unescape_trh': 0,
    'search_trh': 0,
    'unbound_trh': 0,
    'sum_trh': 0,
    'avgExec_trh': 0,
    'maxExec_trh': 0
};

// Get html elements for threshold values
for (var name in trhValues) {
    document.getElementById(name).innerText = trhValues[name];
}

var urlField     = document.getElementById('examinedUrl');
var avgExecField = document.getElementById('avgExec_val');
var maxExecField = document.getElementById('maxExec_val');

chrome.storage.sync.get('currentUrl', function(data) {
    urlField.innerText = urlField.innerText + data.currentUrl;
});

// Get average time and display hints if necessary
chrome.storage.sync.get('avgTime', function(data) {

    avgExecField.innerText = data.avgTime;

    if (data.avgTime === 0) {
        document.getElementById('note').style.visibility = 'visible';
    } else if (data.avgTime > trhValues['avgExec_trh']) {
        avgExecField.classList.add('warning');
        document.getElementById('redFieldsNote').style.visibility = 'visible';
    }
});

// Get maximumg time and display hints if necessary
chrome.storage.sync.get('maxTime', function(data) {

    maxExecField.innerText = data.maxTime;

    if (data.maxTime === 0) {
        document.getElementById('note').style.visibility = 'visible';
    } else if (data.maxTime > trhValues['maxExec_trh']) {
        maxExecField.classList.add('warning');
        document.getElementById('redFieldsNote').style.visibility = 'visible';
    }
});

// Get html an js results and apply them to the view
chrome.storage.sync.get('html_js_results', function(data) {

    htmlJSResults = data.html_js_results;

    for (var name in htmlJSResults) {

        var trh_name = name.replace('_val', '_trh');
        var elem = document.getElementById(name);

        // Check for the boolean and make it readable
        if (name === 'dblDoc_val' && htmlJSResults[name]) {
            elem.innerText = 'yes';
            elem.classList.add('warning');
            document.getElementById('redFieldsNote').style.visibility = 'visible';
            continue;
        } else if (name === 'dblDoc_val' && !htmlJSResults[name]) {
            elem.innerText = 'no';
            continue;
        }

        elem.innerText = htmlJSResults[name];

        if (htmlJSResults[name] > trhValues[trh_name]) {
            elem.classList.add('warning');
            document.getElementById('redFieldsNote').style.visibility = 'visible';
        }
    }
});