'use strict';

var time = 0;
var url = '';

// Establish connection with background script
var backgroundPort = chrome.runtime.connect({name: "dev_port"});

// Get the HTTP Archive (HAR) after performance was tracked
chrome.devtools.network.onRequestFinished.addListener(function(har) {

    /* Send the URL & the according execution time to the background,
       only if it was a JavaScript and is not the jQuery mousewheel integration */
    if (har.request.url.match(/[.]js/gm) && !har.request.url.match(/jquery-mousewheel/gm)) {
        time = har.time;
        url = har.request.url;
        sendToBackground();
    }
});

// Send extracted time and corresponding url back to background
function sendToBackground () {
    backgroundPort.postMessage({
        post_time: time,
        post_url: url
    });
}